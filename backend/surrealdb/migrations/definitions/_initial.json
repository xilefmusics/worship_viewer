{"schemas":"DEFINE TABLE OVERWRITE blob SCHEMAFULL;\n\nDEFINE FIELD OVERWRITE owner ON blob TYPE record<user>\n    ASSERT $value != NONE;\n\nDEFINE FIELD OVERWRITE file_type ON blob TYPE string\n    ASSERT $value INSIDE [\"image/png\", \"image/jpeg\", \"image/svg\"];\n\nDEFINE FIELD OVERWRITE width ON blob TYPE int\n    ASSERT $value >= 0;\n\nDEFINE FIELD OVERWRITE height ON blob TYPE int\n    ASSERT $value >= 0;\n\nDEFINE FIELD OVERWRITE ocr ON blob TYPE string\n    VALUE $value ?? $before ?? \"\";\n\nDEFINE FIELD OVERWRITE created_at ON blob TYPE datetime\n    VALUE $before ?? time::now()\n    READONLY;\n\nDEFINE EVENT OVERWRITE blob_user_cascade ON user\n    WHEN $event = \"DELETE\"\n    THEN DELETE blob WHERE owner = $before.id;\n\nDEFINE TABLE OVERWRITE collection SCHEMAFULL;\n\nDEFINE FIELD OVERWRITE owner ON collection TYPE record<user>\n    ASSERT $value != NONE;\n\nDEFINE FIELD OVERWRITE title ON collection TYPE string\n    ASSERT string::len(string::trim($value)) > 0;\n\nDEFINE FIELD OVERWRITE cover ON collection TYPE OPTION<record<blob>>;\n\nDEFINE FIELD OVERWRITE songs ON collection TYPE array<object>\n    VALUE $value ?? $before ?? [];\n\nDEFINE FIELD OVERWRITE songs.*.id ON collection TYPE record<song>\n    ASSERT $value != NONE;\n\nDEFINE FIELD OVERWRITE songs.*.nr ON collection TYPE option<string>;\nDEFINE FIELD OVERWRITE songs.*.key ON collection TYPE option<object>;\nDEFINE FIELD OVERWRITE songs.*.key.level ON collection TYPE int\n    ASSERT $value >= 0 AND $value < 12;\n\nDEFINE EVENT OVERWRITE collection_user_cascade ON user\n    WHEN $event = \"DELETE\"\n    THEN DELETE collection WHERE owner = $before.id;\n\nDEFINE EVENT OVERWRITE collection_cover_blob_cascade ON blob\n    WHEN $event = \"DELETE\"\n    THEN DELETE collection WHERE cover = $before.id;\n\nDEFINE EVENT OVERWRITE collection_song_remove ON song\n    WHEN $event = \"DELETE\"\n    THEN UPDATE collection\n        SET songs = array::filter(songs, function ($value) {\n            $value.id != $before.id\n        });\n\nDEFINE TABLE OVERWRITE like SCHEMAFULL;\n\nDEFINE FIELD OVERWRITE owner ON like TYPE record<user>\n    ASSERT $value != NONE;\n\nDEFINE FIELD OVERWRITE song ON like TYPE record<song>\n    ASSERT $value != NONE;\n\nDEFINE FIELD OVERWRITE created_at ON like TYPE datetime\n    DEFAULT time::now()\n    VALUE $before ?? $value\n    READONLY;\n\nDEFINE INDEX OVERWRITE like_owner_song_unique ON like COLUMNS owner, song UNIQUE;\n\nDEFINE EVENT OVERWRITE like_user_cascade ON user\n    WHEN $event = \"DELETE\"\n    THEN DELETE like WHERE owner = $before.id;\n\nDEFINE EVENT OVERWRITE like_song_cascade ON song\n    WHEN $event = \"DELETE\"\n    THEN DELETE like WHERE song = $before.id;\n\nDEFINE TABLE OVERWRITE oidc_state SCHEMAFULL;\n\nDEFINE FIELD OVERWRITE pkce_verifier ON oidc_state TYPE string;\nDEFINE FIELD OVERWRITE nonce ON oidc_state TYPE string;\nDEFINE FIELD OVERWRITE redirect_to ON oidc_state TYPE option<string>;\nDEFINE FIELD OVERWRITE created_at ON oidc_state TYPE datetime\n    VALUE $before ?? time::now()\n    READONLY;\nDEFINE FIELD OVERWRITE expires_at ON oidc_state TYPE datetime;\n\nDEFINE INDEX OVERWRITE oidc_state_expires_idx ON oidc_state COLUMNS expires_at;\n\nDEFINE TABLE OVERWRITE otp SCHEMAFULL;\n\nDEFINE FIELD OVERWRITE code ON otp TYPE string;\nDEFINE FIELD OVERWRITE created_at ON otp TYPE datetime\n    VALUE $before ?? time::now()\n    READONLY;\nDEFINE FIELD OVERWRITE expires_at ON otp TYPE datetime;\n\nDEFINE INDEX OVERWRITE otp_expires_idx ON otp COLUMNS expires_at;\n\nDEFINE TABLE OVERWRITE script_migration SCHEMAFULL\n    PERMISSIONS\n        FOR select FULL\n        FOR create, update, delete NONE;\n\nDEFINE FIELD OVERWRITE script_name ON script_migration TYPE string;\nDEFINE FIELD OVERWRITE executed_at ON script_migration TYPE datetime VALUE time::now() READONLY;\nDEFINE FIELD OVERWRITE checksum ON script_migration TYPE option<string>;\n\nDEFINE TABLE OVERWRITE session SCHEMAFULL;\n\nDEFINE FIELD OVERWRITE user ON session TYPE record<user>\n  ASSERT $value != NONE;\n\nDEFINE FIELD OVERWRITE created_at ON session TYPE datetime\n  DEFAULT time::now()\n  VALUE $before ?? $value\n  READONLY;\n\nDEFINE FIELD OVERWRITE expires_at ON session TYPE datetime;\n\nDEFINE INDEX OVERWRITE session_user_idx ON session COLUMNS user;\n\nDEFINE EVENT OVERWRITE session_user_cascade ON user\n    WHEN $event = \"DELETE\"\n    THEN DELETE session WHERE user = $before.id;\n\nDEFINE TABLE OVERWRITE setlist SCHEMAFULL;\n\nDEFINE FIELD OVERWRITE owner ON setlist TYPE record<user>\n    ASSERT $value != NONE;\n\nDEFINE FIELD OVERWRITE title ON setlist TYPE string\n    ASSERT string::len(string::trim($value)) > 0;\n\nDEFINE FIELD OVERWRITE songs ON setlist TYPE array<object>\n    VALUE $value ?? $before ?? [];\n\nDEFINE FIELD OVERWRITE songs.*.id ON setlist TYPE record<song>\n    ASSERT $value != NONE;\n\nDEFINE FIELD OVERWRITE songs.*.nr ON setlist TYPE option<string>;\nDEFINE FIELD OVERWRITE songs.*.key ON setlist TYPE option<object>;\nDEFINE FIELD OVERWRITE songs.*.key.level ON setlist TYPE int\n    ASSERT $value >= 0 AND $value < 12;\n\nDEFINE EVENT OVERWRITE setlist_user_cascade ON user\n    WHEN $event = \"DELETE\"\n    THEN DELETE setlist WHERE owner = $before.id;\n\nDEFINE EVENT OVERWRITE setlist_song_remove ON song\n    WHEN $event = \"DELETE\"\n    THEN UPDATE setlist\n        SET songs = array::filter(songs, function ($value) {\n            $value.id != $before.id\n        });\n\nDEFINE TABLE OVERWRITE song SCHEMAFULL;\n\nDEFINE FIELD OVERWRITE owner ON song TYPE record<user>\n    ASSERT $value != NONE;\n\nDEFINE FIELD OVERWRITE not_a_song ON song TYPE bool\n    VALUE $value ?? $before ?? false;\n\nDEFINE FIELD OVERWRITE blobs ON song TYPE array<record<blob>>\n    VALUE $value ?? $before ?? [];\n\nDEFINE FIELD OVERWRITE data ON song TYPE object\n    ASSERT $value != NONE;\n\nDEFINE FIELD OVERWRITE data.title ON song TYPE string;\n\nDEFINE FIELD OVERWRITE data.subtitle ON song TYPE option<string>;\nDEFINE FIELD OVERWRITE data.copyright ON song TYPE option<string>;\nDEFINE FIELD OVERWRITE data.artist ON song TYPE option<string>;\nDEFINE FIELD OVERWRITE data.language ON song TYPE option<string>;\n\nDEFINE FIELD OVERWRITE data.tempo ON song TYPE option<int>\n    ASSERT $value = NONE OR $value >= 0;\n\nDEFINE FIELD OVERWRITE data.time ON song TYPE option<array<int>>\n    ASSERT $value = NONE OR array::len($value) = 2;\n\nDEFINE FIELD OVERWRITE data.key ON song TYPE option<object>;\nDEFINE FIELD OVERWRITE data.key.level ON song TYPE int\n    ASSERT $value >= 0 AND $value < 12;\n\nDEFINE FIELD OVERWRITE data.sections ON song TYPE array<object>\n    VALUE $value ?? $before ?? [];\n\nDEFINE FIELD OVERWRITE data.sections.*.title ON song TYPE string;\n\nDEFINE FIELD OVERWRITE data.sections.*.lines ON song TYPE array<object>\n    VALUE $value ?? $before ?? [];\n\nDEFINE FIELD OVERWRITE data.sections.*.lines.*.parts ON song TYPE array<object>\n    VALUE $value ?? $before ?? [];\n\nDEFINE FIELD OVERWRITE data.sections.*.lines.*.parts.*.languages ON song TYPE array<string>\n    VALUE $value ?? $before ?? [];\n\nDEFINE FIELD OVERWRITE data.sections.*.lines.*.parts.*.comment ON song TYPE bool\n    VALUE $value ?? $before ?? false;\n\nDEFINE FIELD OVERWRITE data.sections.*.lines.*.parts.*.chord ON song TYPE option<object>;\n\nDEFINE FIELD OVERWRITE data.sections.*.lines.*.parts.*.chord.main ON song TYPE object;\nDEFINE FIELD OVERWRITE data.sections.*.lines.*.parts.*.chord.main.level ON song TYPE int\n    ASSERT $value >= 0 AND $value < 12;\n\nDEFINE FIELD OVERWRITE data.sections.*.lines.*.parts.*.chord.base ON song TYPE option<object>;\nDEFINE FIELD OVERWRITE data.sections.*.lines.*.parts.*.chord.base.level ON song TYPE int\n    ASSERT $value >= 0 AND $value < 12;\n\nDEFINE FIELD OVERWRITE data.sections.*.lines.*.parts.*.chord.kind ON song TYPE string\n    ASSERT $value INSIDE [\"Major\", \"Minor\", \"Diminished\", \"Augmented\", \"Suspended2\", \"Suspended4\"];\n\nDEFINE FIELD OVERWRITE data.sections.*.lines.*.parts.*.chord.var ON song TYPE string\n    VALUE $value ?? $before ?? \"\";\n\nDEFINE FIELD OVERWRITE data.sections.*.lines.*.parts.*.chord.duration ON song TYPE option<int>\n    ASSERT $value = NONE OR $value >= 0;\n\nDEFINE FIELD OVERWRITE data.sections.*.lines.*.parts.*.chord.optional ON song TYPE bool\n    VALUE $value ?? $before ?? false;\n\nDEFINE EVENT OVERWRITE song_user_cascade ON user\n    WHEN $event = \"DELETE\"\n    THEN DELETE song WHERE owner = $before.id;\n\nDEFINE EVENT OVERWRITE song_blob_remove ON blob\n    WHEN $event = \"DELETE\"\n    THEN UPDATE song\n        SET blobs = array::filter(blobs, function ($value) {\n            $value != $before.id\n        });\n\nDEFINE TABLE OVERWRITE user SCHEMAFULL;\n\nDEFINE FIELD OVERWRITE email ON user TYPE string\n    VALUE string::lowercase(string::trim($value))\n    ASSERT string::is::email($value);\n\nDEFINE FIELD OVERWRITE role ON user TYPE string\n    VALUE string::lowercase($value ?? $before ?? \"default\")\n    ASSERT $value INSIDE [\"default\", \"admin\"];\n\nDEFINE FIELD OVERWRITE read ON user TYPE array<record>\n    VALUE $value ?? $before ?? [];\n\nDEFINE FIELD OVERWRITE write ON user TYPE array<record>\n    VALUE $value ?? $before ?? [];\n\nDEFINE FIELD OVERWRITE created_at ON user TYPE datetime\n    VALUE $before ?? time::now()\n    READONLY;\n\nDEFINE FIELD OVERWRITE last_login_at ON user TYPE option<datetime>\n    VALUE $value ?? $before ?? NONE;\n\nDEFINE FIELD OVERWRITE request_count ON user TYPE int\n    VALUE $value ?? $before ?? 0;\n\nDEFINE INDEX OVERWRITE user_email_unique ON user COLUMNS email UNIQUE;\n","events":""}